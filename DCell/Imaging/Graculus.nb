(************** Content-type: application/mathematica **************
                     CreatedBy='Mathematica 5.2'

                    Mathematica-Compatible Notebook

This notebook can be used with any Mathematica-compatible
application, such as Mathematica, MathReader or Publicon. The data
for the notebook starts with the line containing stars above.

To get the notebook into a Mathematica-compatible application, do
one of the following:

* Save the data starting with the line of stars above into a file
  with a name ending in .nb, then open the file inside the
  application;

* Copy the data starting with the line of stars above to the
  clipboard, then use the Paste menu command inside the application.

Data for notebooks contains only printable 7-bit ASCII and can be
sent directly in email or through ftp in text mode.  Newlines can be
CR, LF or CRLF (Unix, Macintosh or MS-DOS style).

NOTE: If you modify the data for this notebook not in a Mathematica-
compatible application, you must delete the line below containing
the word CacheID, otherwise Mathematica-compatible applications may
try to use invalid cache data.

For more information on notebooks and Mathematica-compatible 
applications, contact Wolfram Research:
  web: http://www.wolfram.com
  email: info@wolfram.com
  phone: +1-217-398-0700 (U.S.)

Notebook reader applications are available free of charge from 
Wolfram Research.
*******************************************************************)

(*CacheID: 232*)


(*NotebookFileLineBreakTest
NotebookFileLineBreakTest*)
(*NotebookOptionsPosition[     42096,       1089]*)
(*NotebookOutlinePosition[     42754,       1112]*)
(*  CellTagsIndexPosition[     42710,       1108]*)
(*WindowFrame->Generic*)



Notebook[{
Cell[BoxData[
    \(Get[Environment["\<ALT_DISP\>"]]\)], "Input",
  InitializationCell->True],

Cell[BoxData[
    \(Exit[]\)], "Input"],

Cell[CellGroupData[{

Cell["1D", "Section"],

Cell[CellGroupData[{

Cell[BoxData[
    \(img = Join[Range[10], Range[20, 30]]\)], "Input"],

Cell[BoxData[
    \({1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 
      30}\)], "Output"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
    \(coor = Range[Length[img]]\)], "Input"],

Cell[BoxData[
    \({1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 
      21}\)], "Output"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
    \(adj = \(Complement[coor, {#}] &\) /@ coor\)], "Input"],

Cell[BoxData[
    \({{2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 
        21}, {1, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 
        20, 21}, {1, 2, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 
        19, 20, 21}, {1, 2, 3, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 
        18, 19, 20, 21}, {1, 2, 3, 4, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 
        17, 18, 19, 20, 21}, {1, 2, 3, 4, 5, 7, 8, 9, 10, 11, 12, 13, 14, 15, 
        16, 17, 18, 19, 20, 21}, {1, 2, 3, 4, 5, 6, 8, 9, 10, 11, 12, 13, 14, 
        15, 16, 17, 18, 19, 20, 21}, {1, 2, 3, 4, 5, 6, 7, 9, 10, 11, 12, 13, 
        14, 15, 16, 17, 18, 19, 20, 21}, {1, 2, 3, 4, 5, 6, 7, 8, 10, 11, 12, 
        13, 14, 15, 16, 17, 18, 19, 20, 21}, {1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 
        12, 13, 14, 15, 16, 17, 18, 19, 20, 21}, {1, 2, 3, 4, 5, 6, 7, 8, 9, 
        10, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21}, {1, 2, 3, 4, 5, 6, 7, 8, 
        9, 10, 11, 13, 14, 15, 16, 17, 18, 19, 20, 21}, {1, 2, 3, 4, 5, 6, 7, 
        8, 9, 10, 11, 12, 14, 15, 16, 17, 18, 19, 20, 21}, {1, 2, 3, 4, 5, 6, 
        7, 8, 9, 10, 11, 12, 13, 15, 16, 17, 18, 19, 20, 21}, {1, 2, 3, 4, 5, 
        6, 7, 8, 9, 10, 11, 12, 13, 14, 16, 17, 18, 19, 20, 21}, {1, 2, 3, 4, 
        5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 17, 18, 19, 20, 21}, {1, 2, 3, 
        4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 18, 19, 20, 21}, {1, 2, 
        3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 19, 20, 21}, {1, 
        2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 20, 
        21}, {1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 
        19, 21}, {1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 
        18, 19, 20}}\)], "Output"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
    \(\(W = 
        MapThread[
          Function[{coor, 
              adj}, \[IndentingNewLine]\(Wexp[img[\([coor]\)], img[\([#]\)], 
                  10] &\) /@ adj\[IndentingNewLine]], {coor, 
            adj}];\)\), "\[IndentingNewLine]", 
    \(ArrayPlot[W]\)}], "Input"],

Cell[BoxData[
    TagBox[\(\[SkeletonIndicator]  Graphics  \[SkeletonIndicator]\),
      False,
      Editable->False]], "Output"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
    \(MatrixForm[W]\)], "Input"],

Cell[BoxData[
    TagBox[
      RowBox[{"(", "\[NoBreak]", GridBox[{
            {"99005", "96079", "91393", "85214", "77880", "69768", "61263", 
              "52729", "44486", "2705", "1832", "1216", "791", "504", "315", 
              "193", "116", "68", "39", "22"},
            {"99005", "99005", "96079", "91393", "85214", "77880", "69768", 
              "61263", "52729", "3916", "2705", "1832", "1216", "791", "504", 
              "315", "193", "116", "68", "39"},
            {"96079", "99005", "99005", "96079", "91393", "85214", "77880", 
              "69768", "61263", "5558", "3916", "2705", "1832", "1216", "791",
               "504", "315", "193", "116", "68"},
            {"91393", "96079", "99005", "99005", "96079", "91393", "85214", 
              "77880", "69768", "7730", "5558", "3916", "2705", "1832", 
              "1216", "791", "504", "315", "193", "116"},
            {"85214", "91393", "96079", "99005", "99005", "96079", "91393", 
              "85214", "77880", "10540", "7730", "5558", "3916", "2705", 
              "1832", "1216", "791", "504", "315", "193"},
            {"77880", "85214", "91393", "96079", "99005", "99005", "96079", 
              "91393", "85214", "14086", "10540", "7730", "5558", "3916", 
              "2705", "1832", "1216", "791", "504", "315"},
            {"69768", "77880", "85214", "91393", "96079", "99005", "99005", 
              "96079", "91393", "18452", "14086", "10540", "7730", "5558", 
              "3916", "2705", "1832", "1216", "791", "504"},
            {"61263", "69768", "77880", "85214", "91393", "96079", "99005", 
              "99005", "96079", "23693", "18452", "14086", "10540", "7730", 
              "5558", "3916", "2705", "1832", "1216", "791"},
            {"52729", "61263", "69768", "77880", "85214", "91393", "96079", 
              "99005", "99005", "29820", "23693", "18452", "14086", "10540", 
              "7730", "5558", "3916", "2705", "1832", "1216"},
            {"44486", "52729", "61263", "69768", "77880", "85214", "91393", 
              "96079", "99005", "36788", "29820", "23693", "18452", "14086", 
              "10540", "7730", "5558", "3916", "2705", "1832"},
            {"2705", "3916", "5558", "7730", "10540", "14086", "18452", 
              "23693", "29820", "36788", "99005", "96079", "91393", "85214", 
              "77880", "69768", "61263", "52729", "44486", "36788"},
            {"1832", "2705", "3916", "5558", "7730", "10540", "14086", 
              "18452", "23693", "29820", "99005", "99005", "96079", "91393", 
              "85214", "77880", "69768", "61263", "52729", "44486"},
            {"1216", "1832", "2705", "3916", "5558", "7730", "10540", "14086",
               "18452", "23693", "96079", "99005", "99005", "96079", "91393", 
              "85214", "77880", "69768", "61263", "52729"},
            {"791", "1216", "1832", "2705", "3916", "5558", "7730", "10540", 
              "14086", "18452", "91393", "96079", "99005", "99005", "96079", 
              "91393", "85214", "77880", "69768", "61263"},
            {"504", "791", "1216", "1832", "2705", "3916", "5558", "7730", 
              "10540", "14086", "85214", "91393", "96079", "99005", "99005", 
              "96079", "91393", "85214", "77880", "69768"},
            {"315", "504", "791", "1216", "1832", "2705", "3916", "5558", 
              "7730", "10540", "77880", "85214", "91393", "96079", "99005", 
              "99005", "96079", "91393", "85214", "77880"},
            {"193", "315", "504", "791", "1216", "1832", "2705", "3916", 
              "5558", "7730", "69768", "77880", "85214", "91393", "96079", 
              "99005", "99005", "96079", "91393", "85214"},
            {"116", "193", "315", "504", "791", "1216", "1832", "2705", 
              "3916", "5558", "61263", "69768", "77880", "85214", "91393", 
              "96079", "99005", "99005", "96079", "91393"},
            {"68", "116", "193", "315", "504", "791", "1216", "1832", "2705", 
              "3916", "52729", "61263", "69768", "77880", "85214", "91393", 
              "96079", "99005", "99005", "96079"},
            {"39", "68", "116", "193", "315", "504", "791", "1216", "1832", 
              "2705", "44486", "52729", "61263", "69768", "77880", "85214", 
              "91393", "96079", "99005", "99005"},
            {"22", "39", "68", "116", "193", "315", "504", "791", "1216", 
              "1832", "36788", "44486", "52729", "61263", "69768", "77880", 
              "85214", "91393", "96079", "99005"}
            },
          RowSpacings->1,
          ColumnSpacings->1,
          ColumnAlignments->{Left}], "\[NoBreak]", ")"}],
      Function[ BoxForm`e$, 
        MatrixForm[ BoxForm`e$]]]], "Output"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
    \(AbsoluteTiming[\[IndentingNewLine]\(out = 
          MapThread[
            Function[{adj, 
                W}, \[IndentingNewLine]Flatten[{adj, 
                    W}\[Transpose] ]\[IndentingNewLine]], {adj, 
              W}];\)\[IndentingNewLine]]\)], "Input"],

Cell[BoxData[
    \({0.000637`3.2556844258313213\ Second, Null}\)], "Output"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
    \(out\)], "Input"],

Cell[BoxData[
    \({{2, 99005, 3, 96079, 4, 91393, 5, 85214, 6, 77880, 7, 69768, 8, 61263, 
        9, 52729, 10, 44486, 11, 2705, 12, 1832, 13, 1216, 14, 791, 15, 504, 
        16, 315, 17, 193, 18, 116, 19, 68, 20, 39, 21, 22}, {1, 99005, 3, 
        99005, 4, 96079, 5, 91393, 6, 85214, 7, 77880, 8, 69768, 9, 61263, 
        10, 52729, 11, 3916, 12, 2705, 13, 1832, 14, 1216, 15, 791, 16, 504, 
        17, 315, 18, 193, 19, 116, 20, 68, 21, 39}, {1, 96079, 2, 99005, 4, 
        99005, 5, 96079, 6, 91393, 7, 85214, 8, 77880, 9, 69768, 10, 61263, 
        11, 5558, 12, 3916, 13, 2705, 14, 1832, 15, 1216, 16, 791, 17, 504, 
        18, 315, 19, 193, 20, 116, 21, 68}, {1, 91393, 2, 96079, 3, 99005, 5, 
        99005, 6, 96079, 7, 91393, 8, 85214, 9, 77880, 10, 69768, 11, 7730, 
        12, 5558, 13, 3916, 14, 2705, 15, 1832, 16, 1216, 17, 791, 18, 504, 
        19, 315, 20, 193, 21, 116}, {1, 85214, 2, 91393, 3, 96079, 4, 99005, 
        6, 99005, 7, 96079, 8, 91393, 9, 85214, 10, 77880, 11, 10540, 12, 
        7730, 13, 5558, 14, 3916, 15, 2705, 16, 1832, 17, 1216, 18, 791, 19, 
        504, 20, 315, 21, 193}, {1, 77880, 2, 85214, 3, 91393, 4, 96079, 5, 
        99005, 7, 99005, 8, 96079, 9, 91393, 10, 85214, 11, 14086, 12, 10540, 
        13, 7730, 14, 5558, 15, 3916, 16, 2705, 17, 1832, 18, 1216, 19, 791, 
        20, 504, 21, 315}, {1, 69768, 2, 77880, 3, 85214, 4, 91393, 5, 96079, 
        6, 99005, 8, 99005, 9, 96079, 10, 91393, 11, 18452, 12, 14086, 13, 
        10540, 14, 7730, 15, 5558, 16, 3916, 17, 2705, 18, 1832, 19, 1216, 
        20, 791, 21, 504}, {1, 61263, 2, 69768, 3, 77880, 4, 85214, 5, 91393, 
        6, 96079, 7, 99005, 9, 99005, 10, 96079, 11, 23693, 12, 18452, 13, 
        14086, 14, 10540, 15, 7730, 16, 5558, 17, 3916, 18, 2705, 19, 1832, 
        20, 1216, 21, 791}, {1, 52729, 2, 61263, 3, 69768, 4, 77880, 5, 
        85214, 6, 91393, 7, 96079, 8, 99005, 10, 99005, 11, 29820, 12, 23693, 
        13, 18452, 14, 14086, 15, 10540, 16, 7730, 17, 5558, 18, 3916, 19, 
        2705, 20, 1832, 21, 1216}, {1, 44486, 2, 52729, 3, 61263, 4, 69768, 
        5, 77880, 6, 85214, 7, 91393, 8, 96079, 9, 99005, 11, 36788, 12, 
        29820, 13, 23693, 14, 18452, 15, 14086, 16, 10540, 17, 7730, 18, 
        5558, 19, 3916, 20, 2705, 21, 1832}, {1, 2705, 2, 3916, 3, 5558, 4, 
        7730, 5, 10540, 6, 14086, 7, 18452, 8, 23693, 9, 29820, 10, 36788, 
        12, 99005, 13, 96079, 14, 91393, 15, 85214, 16, 77880, 17, 69768, 18, 
        61263, 19, 52729, 20, 44486, 21, 36788}, {1, 1832, 2, 2705, 3, 3916, 
        4, 5558, 5, 7730, 6, 10540, 7, 14086, 8, 18452, 9, 23693, 10, 29820, 
        11, 99005, 13, 99005, 14, 96079, 15, 91393, 16, 85214, 17, 77880, 18, 
        69768, 19, 61263, 20, 52729, 21, 44486}, {1, 1216, 2, 1832, 3, 2705, 
        4, 3916, 5, 5558, 6, 7730, 7, 10540, 8, 14086, 9, 18452, 10, 23693, 
        11, 96079, 12, 99005, 14, 99005, 15, 96079, 16, 91393, 17, 85214, 18, 
        77880, 19, 69768, 20, 61263, 21, 52729}, {1, 791, 2, 1216, 3, 1832, 
        4, 2705, 5, 3916, 6, 5558, 7, 7730, 8, 10540, 9, 14086, 10, 18452, 
        11, 91393, 12, 96079, 13, 99005, 15, 99005, 16, 96079, 17, 91393, 18, 
        85214, 19, 77880, 20, 69768, 21, 61263}, {1, 504, 2, 791, 3, 1216, 4, 
        1832, 5, 2705, 6, 3916, 7, 5558, 8, 7730, 9, 10540, 10, 14086, 11, 
        85214, 12, 91393, 13, 96079, 14, 99005, 16, 99005, 17, 96079, 18, 
        91393, 19, 85214, 20, 77880, 21, 69768}, {1, 315, 2, 504, 3, 791, 4, 
        1216, 5, 1832, 6, 2705, 7, 3916, 8, 5558, 9, 7730, 10, 10540, 11, 
        77880, 12, 85214, 13, 91393, 14, 96079, 15, 99005, 17, 99005, 18, 
        96079, 19, 91393, 20, 85214, 21, 77880}, {1, 193, 2, 315, 3, 504, 4, 
        791, 5, 1216, 6, 1832, 7, 2705, 8, 3916, 9, 5558, 10, 7730, 11, 
        69768, 12, 77880, 13, 85214, 14, 91393, 15, 96079, 16, 99005, 18, 
        99005, 19, 96079, 20, 91393, 21, 85214}, {1, 116, 2, 193, 3, 315, 4, 
        504, 5, 791, 6, 1216, 7, 1832, 8, 2705, 9, 3916, 10, 5558, 11, 61263, 
        12, 69768, 13, 77880, 14, 85214, 15, 91393, 16, 96079, 17, 99005, 19, 
        99005, 20, 96079, 21, 91393}, {1, 68, 2, 116, 3, 193, 4, 315, 5, 504, 
        6, 791, 7, 1216, 8, 1832, 9, 2705, 10, 3916, 11, 52729, 12, 61263, 
        13, 69768, 14, 77880, 15, 85214, 16, 91393, 17, 96079, 18, 99005, 20, 
        99005, 21, 96079}, {1, 39, 2, 68, 3, 116, 4, 193, 5, 315, 6, 504, 7, 
        791, 8, 1216, 9, 1832, 10, 2705, 11, 44486, 12, 52729, 13, 61263, 14, 
        69768, 15, 77880, 16, 85214, 17, 91393, 18, 96079, 19, 99005, 21, 
        99005}, {1, 22, 2, 39, 3, 68, 4, 116, 5, 193, 6, 315, 7, 504, 8, 791, 
        9, 1216, 10, 1832, 11, 36788, 12, 44486, 13, 52729, 14, 61263, 15, 
        69768, 16, 77880, 17, 85214, 18, 91393, 19, 96079, 20, 
        99005}}\)], "Output"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
    \(output = 
      Prepend[out, {Length[coor], Length[Flatten@adj]/2, 1}]\)], "Input"],

Cell[BoxData[
    \({{21, 210, 1}, {2, 99005, 3, 96079, 4, 91393, 5, 85214, 6, 77880, 7, 
        69768, 8, 61263, 9, 52729, 10, 44486, 11, 2705, 12, 1832, 13, 1216, 
        14, 791, 15, 504, 16, 315, 17, 193, 18, 116, 19, 68, 20, 39, 21, 
        22}, {1, 99005, 3, 99005, 4, 96079, 5, 91393, 6, 85214, 7, 77880, 8, 
        69768, 9, 61263, 10, 52729, 11, 3916, 12, 2705, 13, 1832, 14, 1216, 
        15, 791, 16, 504, 17, 315, 18, 193, 19, 116, 20, 68, 21, 39}, {1, 
        96079, 2, 99005, 4, 99005, 5, 96079, 6, 91393, 7, 85214, 8, 77880, 9, 
        69768, 10, 61263, 11, 5558, 12, 3916, 13, 2705, 14, 1832, 15, 1216, 
        16, 791, 17, 504, 18, 315, 19, 193, 20, 116, 21, 68}, {1, 91393, 2, 
        96079, 3, 99005, 5, 99005, 6, 96079, 7, 91393, 8, 85214, 9, 77880, 
        10, 69768, 11, 7730, 12, 5558, 13, 3916, 14, 2705, 15, 1832, 16, 
        1216, 17, 791, 18, 504, 19, 315, 20, 193, 21, 116}, {1, 85214, 2, 
        91393, 3, 96079, 4, 99005, 6, 99005, 7, 96079, 8, 91393, 9, 85214, 
        10, 77880, 11, 10540, 12, 7730, 13, 5558, 14, 3916, 15, 2705, 16, 
        1832, 17, 1216, 18, 791, 19, 504, 20, 315, 21, 193}, {1, 77880, 2, 
        85214, 3, 91393, 4, 96079, 5, 99005, 7, 99005, 8, 96079, 9, 91393, 
        10, 85214, 11, 14086, 12, 10540, 13, 7730, 14, 5558, 15, 3916, 16, 
        2705, 17, 1832, 18, 1216, 19, 791, 20, 504, 21, 315}, {1, 69768, 2, 
        77880, 3, 85214, 4, 91393, 5, 96079, 6, 99005, 8, 99005, 9, 96079, 
        10, 91393, 11, 18452, 12, 14086, 13, 10540, 14, 7730, 15, 5558, 16, 
        3916, 17, 2705, 18, 1832, 19, 1216, 20, 791, 21, 504}, {1, 61263, 2, 
        69768, 3, 77880, 4, 85214, 5, 91393, 6, 96079, 7, 99005, 9, 99005, 
        10, 96079, 11, 23693, 12, 18452, 13, 14086, 14, 10540, 15, 7730, 16, 
        5558, 17, 3916, 18, 2705, 19, 1832, 20, 1216, 21, 791}, {1, 52729, 2, 
        61263, 3, 69768, 4, 77880, 5, 85214, 6, 91393, 7, 96079, 8, 99005, 
        10, 99005, 11, 29820, 12, 23693, 13, 18452, 14, 14086, 15, 10540, 16, 
        7730, 17, 5558, 18, 3916, 19, 2705, 20, 1832, 21, 1216}, {1, 44486, 
        2, 52729, 3, 61263, 4, 69768, 5, 77880, 6, 85214, 7, 91393, 8, 96079, 
        9, 99005, 11, 36788, 12, 29820, 13, 23693, 14, 18452, 15, 14086, 16, 
        10540, 17, 7730, 18, 5558, 19, 3916, 20, 2705, 21, 1832}, {1, 2705, 
        2, 3916, 3, 5558, 4, 7730, 5, 10540, 6, 14086, 7, 18452, 8, 23693, 9, 
        29820, 10, 36788, 12, 99005, 13, 96079, 14, 91393, 15, 85214, 16, 
        77880, 17, 69768, 18, 61263, 19, 52729, 20, 44486, 21, 36788}, {1, 
        1832, 2, 2705, 3, 3916, 4, 5558, 5, 7730, 6, 10540, 7, 14086, 8, 
        18452, 9, 23693, 10, 29820, 11, 99005, 13, 99005, 14, 96079, 15, 
        91393, 16, 85214, 17, 77880, 18, 69768, 19, 61263, 20, 52729, 21, 
        44486}, {1, 1216, 2, 1832, 3, 2705, 4, 3916, 5, 5558, 6, 7730, 7, 
        10540, 8, 14086, 9, 18452, 10, 23693, 11, 96079, 12, 99005, 14, 
        99005, 15, 96079, 16, 91393, 17, 85214, 18, 77880, 19, 69768, 20, 
        61263, 21, 52729}, {1, 791, 2, 1216, 3, 1832, 4, 2705, 5, 3916, 6, 
        5558, 7, 7730, 8, 10540, 9, 14086, 10, 18452, 11, 91393, 12, 96079, 
        13, 99005, 15, 99005, 16, 96079, 17, 91393, 18, 85214, 19, 77880, 20, 
        69768, 21, 61263}, {1, 504, 2, 791, 3, 1216, 4, 1832, 5, 2705, 6, 
        3916, 7, 5558, 8, 7730, 9, 10540, 10, 14086, 11, 85214, 12, 91393, 
        13, 96079, 14, 99005, 16, 99005, 17, 96079, 18, 91393, 19, 85214, 20, 
        77880, 21, 69768}, {1, 315, 2, 504, 3, 791, 4, 1216, 5, 1832, 6, 
        2705, 7, 3916, 8, 5558, 9, 7730, 10, 10540, 11, 77880, 12, 85214, 13, 
        91393, 14, 96079, 15, 99005, 17, 99005, 18, 96079, 19, 91393, 20, 
        85214, 21, 77880}, {1, 193, 2, 315, 3, 504, 4, 791, 5, 1216, 6, 1832, 
        7, 2705, 8, 3916, 9, 5558, 10, 7730, 11, 69768, 12, 77880, 13, 85214, 
        14, 91393, 15, 96079, 16, 99005, 18, 99005, 19, 96079, 20, 91393, 21, 
        85214}, {1, 116, 2, 193, 3, 315, 4, 504, 5, 791, 6, 1216, 7, 1832, 8, 
        2705, 9, 3916, 10, 5558, 11, 61263, 12, 69768, 13, 77880, 14, 85214, 
        15, 91393, 16, 96079, 17, 99005, 19, 99005, 20, 96079, 21, 
        91393}, {1, 68, 2, 116, 3, 193, 4, 315, 5, 504, 6, 791, 7, 1216, 8, 
        1832, 9, 2705, 10, 3916, 11, 52729, 12, 61263, 13, 69768, 14, 77880, 
        15, 85214, 16, 91393, 17, 96079, 18, 99005, 20, 99005, 21, 
        96079}, {1, 39, 2, 68, 3, 116, 4, 193, 5, 315, 6, 504, 7, 791, 8, 
        1216, 9, 1832, 10, 2705, 11, 44486, 12, 52729, 13, 61263, 14, 69768, 
        15, 77880, 16, 85214, 17, 91393, 18, 96079, 19, 99005, 21, 
        99005}, {1, 22, 2, 39, 3, 68, 4, 116, 5, 193, 6, 315, 7, 504, 8, 791, 
        9, 1216, 10, 1832, 11, 36788, 12, 44486, 13, 52729, 14, 61263, 15, 
        69768, 16, 77880, 17, 85214, 18, 91393, 19, 96079, 20, 
        99005}}\)], "Output"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
    \(Export["\</tmp/graph\>", output, "\<Table\>", 
      ConversionOptions \[Rule] {"\<TableSeparators\>" \[Rule] {"\<\n\>", "\< \
\>"}}]\)], "Input"],

Cell[BoxData[
    \("/tmp/graph"\)], "Output"]
}, Open  ]],

Cell[BoxData[{
    \(\(clusters = 
        Import["\</home/abergman/graculus/graph.part.2\>", "\<List\>"];\)\), \
"\[IndentingNewLine]", 
    \(\(DisplayTogether[\[IndentingNewLine]ListPlot[
          img], \[IndentingNewLine]ListPlot[clusters, 
          PlotStyle \[Rule] Red]\[IndentingNewLine]];\)\)}], "Input"]
}, Closed]],

Cell[CellGroupData[{

Cell["2D", "Section"],

Cell[BoxData[
    \(\(name = "\</home/abergman/restore/mirror/jwang/20081222 Dose Response \
CJW/20081222/10nM-2.spl\>";\)\)], "Input"],

Cell[CellGroupData[{

Cell[BoxData[{
    \(desiredChannel = 
      0;  (*Enter\ 0\ to\ get\ DAPI\ or\ the\ channel\ captured, 
      1\ to\ get\ FITC, 2\ to\ get\ Red*) \n\(numOfChannels = 1;\)\), "\n", 
    \(\(mel = {};\)\), "\n", 
    \(\(is = OpenRead[name, BinaryFormat \[Rule] True];\)\), "\n", 
    \(\(Skip[is, Byte, 2\ 2752];\)\), "\n", 
    \(\(count = 0;\)\), "\n", 
    \(\(Skip[is, Byte, 
        desiredChannel\ \((256\ 256\ 2 + 2\ 128)\)];\)\), "\n", 
    \(While[True, 
      img = BinaryReadList[is, "\<UnsignedInteger16\>", 
          256\ 256]; \[IndentingNewLine]If[img \[Equal] {}, 
        Break[]]; \[IndentingNewLine]Skip[is, Byte, 
        2\ 128]; \[IndentingNewLine]AppendTo[mel, 
        N@Partition[img, 256]]; \[IndentingNewLine]Skip[is, 
        Byte, \((numOfChannels - 1)\)\ \((256\ 256\ 2 + 
              2\ 128)\)];  (*Skipping\ 2\ b/c\ 3\ channels\ are\ captured . 
            If\ only\ 2\ channels\ are\ captured, 
        then\ skip\ 1. \ So\ \
\(\(on\)\(.\)\)*) \[IndentingNewLine]\(count++\);\[IndentingNewLine]]\), "\n\
", 
    \(\(Close[is];\)\), "\n", 
    \(Dimensions[mel]\)}], "Input"],

Cell[BoxData[
    \({90, 256, 256}\)], "Output"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
    \(\(\(\(//\)\(Sign[# - 5000] &\)\);\)\)], "Input"],

Cell[BoxData[
    RowBox[{\(Syntax::"sntxb"\), \(\(:\)\(\ \)\), "\<\"Expression cannot \
begin with \\\"\\!\\(\\(\\(//\\(\\(\\(\\(Sign[\\(\\(# - 5000\\)\\)]\\)\\) \
&\\)\\)\\)\\) ;\\)\\\".\\!\\(\\\"\\\"\\) \\!\\(\\*ButtonBox[\\\"More\
\[Ellipsis]\\\", ButtonStyle->\\\"RefGuideLinkText\\\", ButtonFrame->None, \
ButtonData:>\\\"General::sntxb\\\"]\\)\"\>"}]], "Message"],

Cell[BoxData[
    StyleBox[
      RowBox[{
        ErrorBox[\(\(//\)\(Sign[# - 5000] &\)\)], ";"}],
      ShowStringCharacters->True]], "Message"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
    \(\(img = 
        Take[mel[\([1]\)], {64, 192}, {64, 
            192}];\)\), "\[IndentingNewLine]", 
    \(\(img = mel[\([1]\)];\)\), "\[IndentingNewLine]", 
    \({d1, d2} = Dimensions[img]\), "\[IndentingNewLine]", 
    \(\(ListDensityPlot[img];\)\)}], "Input"],

Cell[BoxData[
    \({256, 256}\)], "Output"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
    \(\(coor = 
        Table[{i, j}, {i, d1}, {j, d2}] // 
          Flatten[#, 1] &;\)\), "\[IndentingNewLine]", 
    \(Dimensions[coor]\)}], "Input"],

Cell[BoxData[
    \({65536, 2}\)], "Output"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
    \(\(r = 4;\)\), "\[IndentingNewLine]", 
    \(\(nei = 
        Table[If[r\^2 \[GreaterEqual] i\^2 + j\^2, \[IndentingNewLine]{i, j}, 
            0\[IndentingNewLine]], {i, \(-r\), r}, {j, \(-r\), 
            r}];\)\), "\[IndentingNewLine]", 
    \(\(nei = Flatten[nei, 1];\)\), "\[IndentingNewLine]", 
    \(\(nei = Complement[nei, {0}];\)\), "\[IndentingNewLine]", 
    \(nei = Complement[nei, {{0, 0}}]\), "\[IndentingNewLine]", 
    \(\(ListPlot[nei];\)\)}], "Input"],

Cell[BoxData[
    \({{\(-4\), 0}, {\(-3\), \(-2\)}, {\(-3\), \(-1\)}, {\(-3\), 0}, {\(-3\), 
        1}, {\(-3\), 
        2}, {\(-2\), \(-3\)}, {\(-2\), \(-2\)}, {\(-2\), \(-1\)}, {\(-2\), 
        0}, {\(-2\), 1}, {\(-2\), 2}, {\(-2\), 
        3}, {\(-1\), \(-3\)}, {\(-1\), \(-2\)}, {\(-1\), \(-1\)}, {\(-1\), 
        0}, {\(-1\), 1}, {\(-1\), 2}, {\(-1\), 
        3}, {0, \(-4\)}, {0, \(-3\)}, {0, \(-2\)}, {0, \(-1\)}, {0, 1}, {0, 
        2}, {0, 3}, {0, 4}, {1, \(-3\)}, {1, \(-2\)}, {1, \(-1\)}, {1, 
        0}, {1, 1}, {1, 2}, {1, 
        3}, {2, \(-3\)}, {2, \(-2\)}, {2, \(-1\)}, {2, 0}, {2, 1}, {2, 
        2}, {2, 3}, {3, \(-2\)}, {3, \(-1\)}, {3, 0}, {3, 1}, {3, 2}, {4, 
        0}}\)], "Output"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
    \(ToNodeIdx = 
      Function[c, 
        c[\([2]\)] + d2 \((c[\([1]\)] - 1)\)]\), "\[IndentingNewLine]", 
    \(ToNodeIdx[{129, 129}]\)}], "Input"],

Cell[BoxData[
    \(Function[c, 
      c\[LeftDoubleBracket]2\[RightDoubleBracket] + 
        d2\ \((c\[LeftDoubleBracket]1\[RightDoubleBracket] - 
              1)\)]\)], "Output"],

Cell[BoxData[
    \(32897\)], "Output"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
    \(AbsoluteTiming[\[IndentingNewLine]\(adj = 
          Function[
              c, \[IndentingNewLine]neicoor = \(c + # &\) /@ 
                  nei; \[IndentingNewLine]Select[neicoor, 
                1 \[LessEqual] #[\([1]\)] \[LessEqual] d1 && 
                    1 \[LessEqual] #[\([2]\)] \[LessEqual] 
                      d2 &]\[IndentingNewLine]] /@ 
            coor;\)\[IndentingNewLine]]\)], "Input"],

Cell[BoxData[
    \({25.891156`7.864696434939463\ Second, Null}\)], "Output"]
}, Open  ]],

Cell[BoxData[
    \(\(ListPlot[Length /@ adj // Sort];\)\)], "Input"],

Cell[BoxData[
    \(\(Wexp = 
        Function[{xi, 
            xj, \[Sigma]}, \[IndentingNewLine]Round[\(10\^5. \) 
              Exp[\(-\(Apply[
                        Plus, \((xi - xj)\)\^2]\/\[Sigma]\^2\)\)]]\
\[IndentingNewLine]];\)\)], "Input"],

Cell[CellGroupData[{

Cell[BoxData[
    \(ListDensityPlot[img]\)], "Input"],

Cell[BoxData[
    TagBox[\(\[SkeletonIndicator]  DensityGraphics  \[SkeletonIndicator]\),
      False,
      Editable->False]], "Output"]
}, Open  ]],

Cell[BoxData[
    \(\(Histogram[Flatten[img]];\)\)], "Input"],

Cell[BoxData[{
    \(\(\[Sigma]I = 200;\)\), "\[IndentingNewLine]", 
    \(\(DisplayTogether[\[IndentingNewLine]Histogram[
          Flatten[img]], \[IndentingNewLine]Plot[
          0.01  Wexp[2800, x, \[Sigma]I], {x, 0, 
            25000}], \[IndentingNewLine]Plot[
          0.01  Wexp[15000, x, \[Sigma]I], {x, 0, 
            25000}]\[IndentingNewLine]];\)\)}], "Input"],

Cell[CellGroupData[{

Cell[BoxData[
    \(AbsoluteTiming[\[IndentingNewLine]\(W = 
          MapThread[
            Function[{coor, adj}, \[IndentingNewLine]pix = 
                Extract[img, 
                  coor]; \[IndentingNewLine]\(Wexp[pix, 
                    Extract[img, #], \[Sigma]I] &\) /@ 
                adj\[IndentingNewLine]], \[IndentingNewLine]{coor, 
              adj}];\)\[IndentingNewLine]]\)], "Input"],

Cell[BoxData[
    \({77.82465`8.342662169706799\ Second, Null}\)], "Output"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
    \(\(Flatten[W] // Sort\) // ListPlot\)], "Input"],

Cell[BoxData[
    TagBox[\(\[SkeletonIndicator]  Graphics  \[SkeletonIndicator]\),
      False,
      Editable->False]], "Output"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
    \(AbsoluteTiming[\[IndentingNewLine]\(out = 
          MapThread[
            Function[{adj, 
                W}, \[IndentingNewLine]Flatten[{ToNodeIdx /@ adj, 
                    W}\[Transpose] ]\[IndentingNewLine]], {adj, 
              W}];\)\[IndentingNewLine]]\)], "Input"],

Cell[BoxData[
    \({32.49358`7.963342556136521\ Second, Null}\)], "Output"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
    \(\(output = 
        Prepend[out, {Length[coor], Length[Flatten@W]/2, 1}];\)\), "\n", 
    \(Export["\</tmp/graph\>", output, "\<Table\>", 
      ConversionOptions \[Rule] {"\<TableSeparators\>" \[Rule] {"\<\n\>", "\< \
\>"}}]\)}], "Input"],

Cell[BoxData[
    \("/tmp/graph"\)], "Output"]
}, Open  ]],

Cell[BoxData[{
    \(\(MAXC = 2;\)\), "\[IndentingNewLine]", 
    \(\(SetDirectory["\</tmp\>"];\)\), "\[IndentingNewLine]", 
    \(Import["\<!/home/abergman/graculus/graclus1.2/graclus /tmp/graph \>" <> 
        ToString[MAXC], "\<Text\>"]\)}], "Input"],

Cell[BoxData[{
    \(clear\), "\[IndentingNewLine]", 
    \(\(clusters = 
        Import["\</tmp/graph.part.\>" <> 
            ToString[MAXC], "\<List\>"];\)\), "\n", 
    \(\(clusters = Partition[clusters, d1];\)\), "\[IndentingNewLine]", 
    \(\(DisplayTogether[\[IndentingNewLine]ListDensityPlot[
          img], \[IndentingNewLine]\(ListContourPlot[clusters, 
              PlotRange \[Rule] All, ContourShading \[Rule] None, 
              Contours \[Rule] {# + 0.5}, 
              ContourStyle \[Rule] Hue[#\/MAXC]] &\) /@ 
          Range[0, MAXC - 1]\[IndentingNewLine]];\)\)}], "Input"],

Cell[CellGroupData[{

Cell[BoxData[
    \(ListDensityPlot[clusters]\)], "Input"],

Cell[BoxData[
    TagBox[\(\[SkeletonIndicator]  DensityGraphics  \[SkeletonIndicator]\),
      False,
      Editable->False]], "Output"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
    \(Union[Flatten[clusters]]\)], "Input"],

Cell[BoxData[
    \({0, 1, 2, 3, 4}\)], "Output"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
    \(ListPlot[img[\([117]\)]]\)], "Input"],

Cell[BoxData[
    TagBox[\(\[SkeletonIndicator]  Graphics  \[SkeletonIndicator]\),
      False,
      Editable->False]], "Output"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Spectral Clustering", "Section"],

Cell[BoxData[
    \(\(CircleCell = 
        Function[{r, 
            c}, \(-Table[\((i - c[\([\)\(1\)\(]\)])\)\^2 + \((j - \
c[\([\)\(2\)\(]\)])\)\^2 - r\^2 // UnitStep, {i, d1}, {j, 
                d1}]\)];\)\)], "Input"],

Cell[BoxData[{
    \(\(d1 = 32;\)\), "\[IndentingNewLine]", 
    \(\(d2 = d1;\)\), "\[IndentingNewLine]", 
    \(\(img = 
        CircleCell[5, {12, 13}] + 
          CircleCell[6, {20, 20}];\)\), "\[IndentingNewLine]", 
    \(clear\), "\[IndentingNewLine]", 
    \(\(ListDensityPlot[img];\)\)}], "Input"],

Cell[CellGroupData[{

Cell[BoxData[{
    \(\(coor = 
        Table[{i, j}, {i, d1}, {j, d2}] // 
          Flatten[#, 1] &;\)\), "\[IndentingNewLine]", 
    \(Dimensions[coor]\)}], "Input"],

Cell[BoxData[
    \({1024, 2}\)], "Output"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
    \(\(r = 4;\)\), "\[IndentingNewLine]", 
    \(\(nei = 
        Table[If[r\^2 \[GreaterEqual] i\^2 + j\^2, \[IndentingNewLine]{i, j}, 
            0\[IndentingNewLine]], {i, \(-r\), r}, {j, \(-r\), 
            r}];\)\), "\[IndentingNewLine]", 
    \(\(nei = Flatten[nei, 1];\)\), "\[IndentingNewLine]", 
    \(\(nei = Complement[nei, {0}];\)\), "\[IndentingNewLine]", 
    \(nei = Complement[nei, {{0, 0}}]\), "\[IndentingNewLine]", 
    \(\(ListPlot[nei];\)\)}], "Input"],

Cell[BoxData[
    \({{\(-4\), 0}, {\(-3\), \(-2\)}, {\(-3\), \(-1\)}, {\(-3\), 0}, {\(-3\), 
        1}, {\(-3\), 
        2}, {\(-2\), \(-3\)}, {\(-2\), \(-2\)}, {\(-2\), \(-1\)}, {\(-2\), 
        0}, {\(-2\), 1}, {\(-2\), 2}, {\(-2\), 
        3}, {\(-1\), \(-3\)}, {\(-1\), \(-2\)}, {\(-1\), \(-1\)}, {\(-1\), 
        0}, {\(-1\), 1}, {\(-1\), 2}, {\(-1\), 
        3}, {0, \(-4\)}, {0, \(-3\)}, {0, \(-2\)}, {0, \(-1\)}, {0, 1}, {0, 
        2}, {0, 3}, {0, 4}, {1, \(-3\)}, {1, \(-2\)}, {1, \(-1\)}, {1, 
        0}, {1, 1}, {1, 2}, {1, 
        3}, {2, \(-3\)}, {2, \(-2\)}, {2, \(-1\)}, {2, 0}, {2, 1}, {2, 
        2}, {2, 3}, {3, \(-2\)}, {3, \(-1\)}, {3, 0}, {3, 1}, {3, 2}, {4, 
        0}}\)], "Output"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
    \(ToNodeIdx = 
      Function[c, 
        c[\([2]\)] + d2 \((c[\([1]\)] - 1)\)]\), "\[IndentingNewLine]", 
    \(ToNodeIdx[{129, 129}]\)}], "Input"],

Cell[BoxData[
    \(Function[c, 
      c\[LeftDoubleBracket]2\[RightDoubleBracket] + 
        d2\ \((c\[LeftDoubleBracket]1\[RightDoubleBracket] - 
              1)\)]\)], "Output"],

Cell[BoxData[
    \(4225\)], "Output"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
    \(AbsoluteTiming[\[IndentingNewLine]\(adj = 
          Function[
              c, \[IndentingNewLine]neicoor = \(c + # &\) /@ 
                  nei; \[IndentingNewLine]Select[neicoor, 
                1 \[LessEqual] #[\([1]\)] \[LessEqual] d1 && 
                    1 \[LessEqual] #[\([2]\)] \[LessEqual] 
                      d2 &]\[IndentingNewLine]] /@ 
            coor;\)\[IndentingNewLine]]\)], "Input"],

Cell[BoxData[
    \({0.333326`5.9744141841926055\ Second, Null}\)], "Output"]
}, Open  ]],

Cell[BoxData[
    \(\(Wexp = 
        Function[{xi, 
            xj, \[Sigma]}, \[IndentingNewLine]N@\(Chop@
              Exp[\(-\(Apply[
                        Plus, \((xi - xj)\)\^2]\/\[Sigma]\^2\)\)]\)\
\[IndentingNewLine]];\)\)], "Input"],

Cell[CellGroupData[{

Cell[BoxData[{
    \(\(\[Sigma]I =  .1;\)\), "\[IndentingNewLine]", 
    \(\(DisplayTogether[\[IndentingNewLine]Histogram[
          Flatten[img]], \[IndentingNewLine]Plot[\(10\^3\) 
            Wexp[2800, x, \[Sigma]I], {x, 0, 
            25000}], \[IndentingNewLine]Plot[\(10\^3\) 
            Wexp[15000, x, \[Sigma]I], {x, 0, 
            25000}]\[IndentingNewLine]];\)\)}], "Input"],

Cell[BoxData[
    RowBox[{\(General::"unfl"\), \(\(:\)\(\ \)\), "\<\"Underflow occurred in \
computation. \\!\\(\\*ButtonBox[\\\"More\[Ellipsis]\\\", \
ButtonStyle->\\\"RefGuideLinkText\\\", ButtonFrame->None, \
ButtonData:>\\\"General::unfl\\\"]\\)\"\>"}]], "Message"],

Cell[BoxData[
    RowBox[{\(General::"unfl"\), \(\(:\)\(\ \)\), "\<\"Underflow occurred in \
computation. \\!\\(\\*ButtonBox[\\\"More\[Ellipsis]\\\", \
ButtonStyle->\\\"RefGuideLinkText\\\", ButtonFrame->None, \
ButtonData:>\\\"General::unfl\\\"]\\)\"\>"}]], "Message"],

Cell[BoxData[
    RowBox[{\(General::"unfl"\), \(\(:\)\(\ \)\), "\<\"Underflow occurred in \
computation. \\!\\(\\*ButtonBox[\\\"More\[Ellipsis]\\\", \
ButtonStyle->\\\"RefGuideLinkText\\\", ButtonFrame->None, \
ButtonData:>\\\"General::unfl\\\"]\\)\"\>"}]], "Message"],

Cell[BoxData[
    RowBox[{\(General::"stop"\), \(\(:\)\(\ \)\), "\<\"Further output of \
\\!\\(General :: \\\"unfl\\\"\\) will be suppressed during this calculation. \
\\!\\(\\*ButtonBox[\\\"More\[Ellipsis]\\\", ButtonStyle->\\\"RefGuideLinkText\
\\\", ButtonFrame->None, ButtonData:>\\\"General::stop\\\"]\\)\"\>"}]], \
"Message"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
    \(AbsoluteTiming[\[IndentingNewLine]\(W = 
          MapThread[
            Function[{coor, adj}, \[IndentingNewLine]pix = 
                Extract[img, 
                  coor]; \[IndentingNewLine]\(Wexp[pix, 
                    Extract[img, #], \[Sigma]I] &\) /@ 
                adj\[IndentingNewLine]], \[IndentingNewLine]{coor, 
              adj}];\)\[IndentingNewLine]]\)], "Input"],

Cell[BoxData[
    \({1.070251`6.481030635790011\ Second, Null}\)], "Output"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
    \(W[\([333]\)]\)], "Input"],

Cell[BoxData[
    \({0.`, 1.`, 1.`, 1.`, 1.`, 1.`, 1.`, 1.`, 1.`, 1.`, 1.`, 1.`, 1.`, 1.`, 
      1.`, 1.`, 1.`, 1.`, 1.`, 1.`, 1.`, 1.`, 1.`, 1.`, 1.`, 1.`, 1.`, 1.`, 
      1.`, 1.`, 1.`, 1.`, 1.`, 1.`, 1.`, 1.`, 1.`, 1.`, 1.`, 1.`, 1.`, 1.`, 
      1.`, 1.`, 1.`, 1.`, 1.`, 1.`}\)], "Output"]
}, Open  ]],

Cell[BoxData[{
    \(\(pos = 
        MapThread[
          Function[{c, 
              a}, \[IndentingNewLine]Thread[{ToNodeIdx[c], 
                ToNodeIdx /@ a}]\[IndentingNewLine]], {coor, 
            adj}];\)\), "\[IndentingNewLine]", 
    \(\(pos = Flatten[pos, 1];\)\)}], "Input"],

Cell[CellGroupData[{

Cell[BoxData[
    \(sp = SparseArray[pos \[Rule] Flatten[W]]\)], "Input"],

Cell[BoxData[
    TagBox[
      RowBox[{"SparseArray", "[", 
        RowBox[{
          
          InterpretationBox[\("<"\[InvisibleSpace]39428\[InvisibleSpace]">"\),
            
            SequenceForm[ "<", 39428, ">"],
            Editable->False], ",", \({1024, 1024}\)}], "]"}],
      False,
      Editable->False]], "Output"]
}, Open  ]],

Cell[BoxData[
    \(\(ArrayPlot[Take[sp, 1000, 1000]];\)\)], "Input"],

Cell[BoxData[
    \(\(ListDensityPlot[Take[sp, 1000, 1000]];\)\)], "Input"],

Cell[BoxData[{
    \(\(DD = Total /@ W;\)\), "\[IndentingNewLine]", 
    \(\(iDD = DD\^\(-0.5\);\)\), "\[IndentingNewLine]", 
    \(\(DDm = SparseArray[ipos \[Rule] DD];\)\), "\n", 
    \(\(iDDm = SparseArray[ipos \[Rule] iDD];\)\)}], "Input"],

Cell[CellGroupData[{

Cell[BoxData[
    \(ListPlot[Sort[DD]]\)], "Input"],

Cell[BoxData[
    TagBox[\(\[SkeletonIndicator]  Graphics  \[SkeletonIndicator]\),
      False,
      Editable->False]], "Output"]
}, Open  ]],

Cell[BoxData[
    \(\(ListDensityPlot[Partition[DD, d1]];\)\)], "Input"],

Cell[BoxData[
    \(\(ipos = \({#, #} &\) /@ Range[Length[sp]];\)\)], "Input"],

Cell[BoxData[{
    \(\(L = DDm - sp;\)\), "\[IndentingNewLine]", 
    \(\(Ln = iDDm . L . iDDm;\)\)}], "Input"],

Cell[BoxData[
    \(ArrayPlot[L]\)], "Input"],

Cell[CellGroupData[{

Cell[BoxData[
    \(ArrayPlot[Take[mat, 1000, 1000]]\)], "Input"],

Cell[BoxData[
    TagBox[\(\[SkeletonIndicator]  Graphics  \[SkeletonIndicator]\),
      False,
      Editable->False]], "Output"]
}, Open  ]],

Cell[BoxData[
    \(\({eval, evec} = 
        Eigensystem[L, \(-9\), 
          Method \[Rule] {"\<Arnoldi\>", BasisSize \[Rule] 30, 
              MaxIterations \[Rule] 100000}];\)\)], "Input"],

Cell[BoxData[
    \(\({eval, evec} = 
        Eigensystem[{L, DDm}, \(-18\), 
          Method \[Rule] {"\<Arnoldi\>", BasisSize \[Rule] 30, 
              MaxIterations \[Rule] 100000}];\)\)], "Input"],

Cell[BoxData[
    \(\({eval, evec} = 
        Eigensystem[Ln, \(-18\), 
          Method \[Rule] {"\<Arnoldi\>", BasisSize \[Rule] 30, 
              MaxIterations \[Rule] 100000}];\)\)], "Input"],

Cell[CellGroupData[{

Cell[BoxData[{
    \(clear\), "\[IndentingNewLine]", 
    \(\(ListDensityPlot[Partition[#, d1]] &\) /@ evec\)}], "Input"],

Cell[BoxData[
    RowBox[{"{", 
      RowBox[{
        TagBox[\(\[SkeletonIndicator]  
            DensityGraphics  \[SkeletonIndicator]\),
          False,
          Editable->False], ",", 
        TagBox[\(\[SkeletonIndicator]  
            DensityGraphics  \[SkeletonIndicator]\),
          False,
          Editable->False], ",", 
        TagBox[\(\[SkeletonIndicator]  
            DensityGraphics  \[SkeletonIndicator]\),
          False,
          Editable->False], ",", 
        TagBox[\(\[SkeletonIndicator]  
            DensityGraphics  \[SkeletonIndicator]\),
          False,
          Editable->False], ",", 
        TagBox[\(\[SkeletonIndicator]  
            DensityGraphics  \[SkeletonIndicator]\),
          False,
          Editable->False], ",", 
        TagBox[\(\[SkeletonIndicator]  
            DensityGraphics  \[SkeletonIndicator]\),
          False,
          Editable->False], ",", 
        TagBox[\(\[SkeletonIndicator]  
            DensityGraphics  \[SkeletonIndicator]\),
          False,
          Editable->False], ",", 
        TagBox[\(\[SkeletonIndicator]  
            DensityGraphics  \[SkeletonIndicator]\),
          False,
          Editable->False], ",", 
        TagBox[\(\[SkeletonIndicator]  
            DensityGraphics  \[SkeletonIndicator]\),
          False,
          Editable->False], ",", 
        TagBox[\(\[SkeletonIndicator]  
            DensityGraphics  \[SkeletonIndicator]\),
          False,
          Editable->False], ",", 
        TagBox[\(\[SkeletonIndicator]  
            DensityGraphics  \[SkeletonIndicator]\),
          False,
          Editable->False], ",", 
        TagBox[\(\[SkeletonIndicator]  
            DensityGraphics  \[SkeletonIndicator]\),
          False,
          Editable->False], ",", 
        TagBox[\(\[SkeletonIndicator]  
            DensityGraphics  \[SkeletonIndicator]\),
          False,
          Editable->False], ",", 
        TagBox[\(\[SkeletonIndicator]  
            DensityGraphics  \[SkeletonIndicator]\),
          False,
          Editable->False], ",", 
        TagBox[\(\[SkeletonIndicator]  
            DensityGraphics  \[SkeletonIndicator]\),
          False,
          Editable->False], ",", 
        TagBox[\(\[SkeletonIndicator]  
            DensityGraphics  \[SkeletonIndicator]\),
          False,
          Editable->False], ",", 
        TagBox[\(\[SkeletonIndicator]  
            DensityGraphics  \[SkeletonIndicator]\),
          False,
          Editable->False], ",", 
        TagBox[\(\[SkeletonIndicator]  
            DensityGraphics  \[SkeletonIndicator]\),
          False,
          Editable->False]}], "}"}]], "Output"]
}, Open  ]],

Cell[BoxData[
    \(\(ListDensityPlot[img];\)\)], "Input"],

Cell[CellGroupData[{

Cell[BoxData[
    \(Show[Graphics3D[Point /@ Transpose[evec]], 
      PlotRange \[Rule] All]\)], "Input"],

Cell[BoxData[
    TagBox[\(\[SkeletonIndicator]  Graphics3D  \[SkeletonIndicator]\),
      False,
      Editable->False]], "Output"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
    \(ListPlot[
      Transpose[{evec[\([\(-6\)]\)], evec[\([\(-2\)]\)]}]]\)], "Input"],

Cell[BoxData[
    TagBox[\(\[SkeletonIndicator]  Graphics  \[SkeletonIndicator]\),
      False,
      Editable->False]], "Output"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
    \(ListPlot[eval]\)], "Input"],

Cell[BoxData[
    TagBox[\(\[SkeletonIndicator]  Graphics  \[SkeletonIndicator]\),
      False,
      Editable->False]], "Output"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
    \(\(ListDensityPlot[Partition[#, d1]] &\) /@ {evec[\([\)\(-6\)\(]\)], 
        evec[\([\)\(-2\)\(]\)]}\)], "Input"],

Cell[BoxData[
    RowBox[{"{", 
      RowBox[{
        TagBox[\(\[SkeletonIndicator]  
            DensityGraphics  \[SkeletonIndicator]\),
          False,
          Editable->False], ",", 
        TagBox[\(\[SkeletonIndicator]  
            DensityGraphics  \[SkeletonIndicator]\),
          False,
          Editable->False]}], "}"}]], "Output"]
}, Open  ]],

Cell[BoxData[
    \(\(X = 
        Transpose[{evec[\([\)\(-6\)\(]\)], 
            evec[\([\)\(-2\)\(]\)]}];\)\)], "Input"],

Cell[CellGroupData[{

Cell[BoxData[
    \(\(\(ListPlot[X\/Norm /@ X]\)\(\[IndentingNewLine]\)
    \)\)], "Input"],

Cell[BoxData[
    TagBox[\(\[SkeletonIndicator]  Graphics  \[SkeletonIndicator]\),
      False,
      Editable->False]], "Output"]
}, Open  ]]
}, Open  ]]
},
FrontEndVersion->"5.2 for X",
ScreenRectangle->{{0, 2400}, {0, 1600}},
AutoGeneratedPackage->None,
WindowSize->{1200, 1550},
WindowMargins->{{0, Automatic}, {0, Automatic}}
]

(*******************************************************************
Cached data follows.  If you edit this Notebook file directly, not
using Mathematica, you must remove the line containing CacheID at
the top of  the file.  The cache data will then be recreated when
you save this file from within Mathematica.
*******************************************************************)

(*CellTagsOutline
CellTagsIndex->{}
*)

(*CellTagsIndex
CellTagsIndex->{}
*)

(*NotebookFileOutline
Notebook[{
Cell[1755, 51, 93, 2, 27, "Input",
  InitializationCell->True],
Cell[1851, 55, 39, 1, 27, "Input"],

Cell[CellGroupData[{
Cell[1915, 60, 21, 0, 74, "Section"],

Cell[CellGroupData[{
Cell[1961, 64, 69, 1, 27, "Input"],
Cell[2033, 67, 116, 2, 27, "Output"]
}, Open  ]],

Cell[CellGroupData[{
Cell[2186, 74, 58, 1, 27, "Input"],
Cell[2247, 77, 116, 2, 27, "Output"]
}, Open  ]],

Cell[CellGroupData[{
Cell[2400, 84, 74, 1, 27, "Input"],
Cell[2477, 87, 1774, 23, 187, "Output"]
}, Open  ]],

Cell[CellGroupData[{
Cell[4288, 115, 294, 7, 75, "Input"],
Cell[4585, 124, 130, 3, 27, "Output"]
}, Open  ]],

Cell[CellGroupData[{
Cell[4752, 132, 46, 1, 27, "Input"],
Cell[4801, 135, 4712, 71, 400, "Output"]
}, Open  ]],

Cell[CellGroupData[{
Cell[9550, 211, 284, 6, 91, "Input"],
Cell[9837, 219, 77, 1, 27, "Output"]
}, Open  ]],

Cell[CellGroupData[{
Cell[9951, 225, 36, 1, 27, "Input"],
Cell[9990, 228, 4812, 63, 523, "Output"]
}, Open  ]],

Cell[CellGroupData[{
Cell[14839, 296, 103, 2, 27, "Input"],
Cell[14945, 300, 4835, 64, 523, "Output"]
}, Open  ]],

Cell[CellGroupData[{
Cell[19817, 369, 166, 3, 27, "Input"],
Cell[19986, 374, 46, 1, 27, "Output"]
}, Open  ]],
Cell[20047, 378, 315, 6, 91, "Input"]
}, Closed]],

Cell[CellGroupData[{
Cell[20399, 389, 21, 0, 44, "Section"],
Cell[20423, 391, 135, 2, 27, "Input"],

Cell[CellGroupData[{
Cell[20583, 397, 1111, 23, 267, "Input"],
Cell[21697, 422, 48, 1, 27, "Output"]
}, Open  ]],

Cell[CellGroupData[{
Cell[21782, 428, 68, 1, 27, "Input"],
Cell[21853, 431, 370, 5, 20, "Message"],
Cell[22226, 438, 146, 4, 24, "Message"]
}, Open  ]],

Cell[CellGroupData[{
Cell[22409, 447, 284, 6, 75, "Input"],
Cell[22696, 455, 44, 1, 27, "Output"]
}, Open  ]],

Cell[CellGroupData[{
Cell[22777, 461, 167, 4, 43, "Input"],
Cell[22947, 467, 44, 1, 27, "Output"]
}, Open  ]],

Cell[CellGroupData[{
Cell[23028, 473, 491, 9, 148, "Input"],
Cell[23522, 484, 717, 12, 59, "Output"]
}, Open  ]],

Cell[CellGroupData[{
Cell[24276, 501, 167, 4, 43, "Input"],
Cell[24446, 507, 181, 4, 27, "Output"],
Cell[24630, 513, 39, 1, 27, "Output"]
}, Open  ]],

Cell[CellGroupData[{
Cell[24706, 519, 430, 8, 107, "Input"],
Cell[25139, 529, 77, 1, 27, "Output"]
}, Open  ]],
Cell[25231, 533, 69, 1, 27, "Input"],
Cell[25303, 536, 252, 6, 86, "Input"],

Cell[CellGroupData[{
Cell[25580, 546, 53, 1, 27, "Input"],
Cell[25636, 549, 137, 3, 27, "Output"]
}, Open  ]],
Cell[25788, 555, 61, 1, 27, "Input"],
Cell[25852, 558, 376, 7, 107, "Input"],

Cell[CellGroupData[{
Cell[26253, 569, 408, 8, 123, "Input"],
Cell[26664, 579, 76, 1, 27, "Output"]
}, Open  ]],

Cell[CellGroupData[{
Cell[26777, 585, 67, 1, 27, "Input"],
Cell[26847, 588, 130, 3, 27, "Output"]
}, Open  ]],

Cell[CellGroupData[{
Cell[27014, 596, 297, 6, 91, "Input"],
Cell[27314, 604, 76, 1, 27, "Output"]
}, Open  ]],

Cell[CellGroupData[{
Cell[27427, 610, 260, 5, 43, "Input"],
Cell[27690, 617, 46, 1, 27, "Output"]
}, Open  ]],
Cell[27751, 621, 253, 4, 59, "Input"],
Cell[28007, 627, 598, 11, 149, "Input"],

Cell[CellGroupData[{
Cell[28630, 642, 58, 1, 27, "Input"],
Cell[28691, 645, 137, 3, 27, "Output"]
}, Open  ]],

Cell[CellGroupData[{
Cell[28865, 653, 57, 1, 27, "Input"],
Cell[28925, 656, 49, 1, 27, "Output"]
}, Open  ]],

Cell[CellGroupData[{
Cell[29011, 662, 57, 1, 27, "Input"],
Cell[29071, 665, 130, 3, 27, "Output"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{
Cell[29250, 674, 38, 0, 74, "Section"],
Cell[29291, 676, 224, 5, 31, "Input"],
Cell[29518, 683, 305, 7, 91, "Input"],

Cell[CellGroupData[{
Cell[29848, 694, 167, 4, 43, "Input"],
Cell[30018, 700, 43, 1, 27, "Output"]
}, Open  ]],

Cell[CellGroupData[{
Cell[30098, 706, 491, 9, 148, "Input"],
Cell[30592, 717, 717, 12, 59, "Output"]
}, Open  ]],

Cell[CellGroupData[{
Cell[31346, 734, 167, 4, 43, "Input"],
Cell[31516, 740, 181, 4, 27, "Output"],
Cell[31700, 746, 38, 1, 27, "Output"]
}, Open  ]],

Cell[CellGroupData[{
Cell[31775, 752, 430, 8, 107, "Input"],
Cell[32208, 762, 77, 1, 27, "Output"]
}, Open  ]],
Cell[32300, 766, 244, 6, 86, "Input"],

Cell[CellGroupData[{
Cell[32569, 776, 388, 7, 122, "Input"],
Cell[32960, 785, 269, 4, 20, "Message"],
Cell[33232, 791, 269, 4, 20, "Message"],
Cell[33504, 797, 269, 4, 20, "Message"],
Cell[33776, 803, 331, 5, 20, "Message"]
}, Open  ]],

Cell[CellGroupData[{
Cell[34144, 813, 408, 8, 123, "Input"],
Cell[34555, 823, 76, 1, 27, "Output"]
}, Open  ]],

Cell[CellGroupData[{
Cell[34668, 829, 45, 1, 27, "Input"],
Cell[34716, 832, 295, 4, 43, "Output"]
}, Open  ]],
Cell[35026, 839, 289, 7, 75, "Input"],

Cell[CellGroupData[{
Cell[35340, 850, 73, 1, 27, "Input"],
Cell[35416, 853, 334, 10, 27, "Output"]
}, Open  ]],
Cell[35765, 866, 69, 1, 27, "Input"],
Cell[35837, 869, 75, 1, 27, "Input"],
Cell[35915, 872, 243, 4, 77, "Input"],

Cell[CellGroupData[{
Cell[36183, 880, 51, 1, 27, "Input"],
Cell[36237, 883, 130, 3, 27, "Output"]
}, Open  ]],
Cell[36382, 889, 72, 1, 27, "Input"],
Cell[36457, 892, 78, 1, 27, "Input"],
Cell[36538, 895, 111, 2, 43, "Input"],
Cell[36652, 899, 45, 1, 27, "Input"],

Cell[CellGroupData[{
Cell[36722, 904, 65, 1, 27, "Input"],
Cell[36790, 907, 130, 3, 27, "Output"]
}, Open  ]],
Cell[36935, 913, 194, 4, 27, "Input"],
Cell[37132, 919, 202, 4, 27, "Input"],
Cell[37337, 925, 196, 4, 27, "Input"],

Cell[CellGroupData[{
Cell[37558, 933, 121, 2, 43, "Input"],
Cell[37682, 937, 2652, 74, 59, "Output"]
}, Open  ]],
Cell[40349, 1014, 58, 1, 27, "Input"],

Cell[CellGroupData[{
Cell[40432, 1019, 105, 2, 27, "Input"],
Cell[40540, 1023, 132, 3, 27, "Output"]
}, Open  ]],

Cell[CellGroupData[{
Cell[40709, 1031, 101, 2, 27, "Input"],
Cell[40813, 1035, 130, 3, 27, "Output"]
}, Open  ]],

Cell[CellGroupData[{
Cell[40980, 1043, 47, 1, 27, "Input"],
Cell[41030, 1046, 130, 3, 27, "Output"]
}, Open  ]],

Cell[CellGroupData[{
Cell[41197, 1054, 133, 2, 27, "Input"],
Cell[41333, 1058, 348, 10, 27, "Output"]
}, Open  ]],
Cell[41696, 1071, 123, 3, 27, "Input"],

Cell[CellGroupData[{
Cell[41844, 1078, 91, 2, 62, "Input"],
Cell[41938, 1082, 130, 3, 27, "Output"]
}, Open  ]]
}, Open  ]]
}
]
*)



(*******************************************************************
End of Mathematica Notebook file.
*******************************************************************)

